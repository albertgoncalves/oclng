fib n {
    let scope (alloc 2);
    seta scope 0 0;
    seta scope 1 1;
    let loop \scope n {
        switch (= n 0) {
            let a (get scope 0);
            let b (get scope 1);
            seta scope 0 b;
            seta scope 1 (+ a b);
            (loop scope (- n 1))
        } {
            (get scope 0)
        }
    };
    (print_stack);
    (loop scope n)
}

entry {
    (printf "%ld\n" (fib 51));
    0
}
